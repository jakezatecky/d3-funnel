/*! d3-funnel - v0.7.5 | 2016 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):"object"==typeof exports?exports.D3Funnel=e(require("d3")):t.D3Funnel=e(t.d3)}(this,function(t){return function(t){function e(a){if(i[a])return i[a].exports;var r=i[a]={exports:{},id:a,loaded:!1};return t[a].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";t.exports=i(1)["default"]},function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t},o=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),l=i(2),s=a(l),h=i(3),u=a(h),c=i(4),f=a(c),d=i(5),v=a(d),y=i(6),b=a(y),g=function(){function t(e){r(this,t),this.selector=e,this.colorizer=new u["default"],this.labelFormatter=new f["default"],this.navigator=new v["default"]}return o(t,[{key:"destroy",value:function(){var t=s["default"].select(this.selector);t.selectAll("svg").remove(),t.selectAll("*").remove(),t.text("")}},{key:"draw",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];this.destroy(),this._initialize(t,e),this._draw()}},{key:"_initialize",value:function(t,e){this._validateData(t);var i=this._getSettings(e);this.label=i.label,this.labelFormatter.setFormat(this.label.format),this.colorizer.setLabelFill(i.label.fill),this.colorizer.setScale(i.block.fill.scale),this.width=i.chart.width,this.height=i.chart.height,this.bottomWidth=i.chart.width*i.chart.bottomWidth,this.bottomPinch=i.chart.bottomPinch,this.isInverted=i.chart.inverted,this.isHorizontal=i.chart.horizontal,this.isCurved=i.chart.curve.enabled,this.addValueOverlay=i.chart.addValueOverlay,this.curveHeight=i.chart.curve.height,this.fillType=i.block.fill.type,this.hoverEffects=i.block.highlight,this.dynamicHeight=i.block.dynamicHeight,this.minHeight=i.block.minHeight,this.animation=i.chart.animate,this.onBlockClick=i.events.click.block,this._setBlocks(t,e),this.bottomLeftX=(this.width-this.bottomWidth)/2,this.dx=this._getDx(),this.dy=this._getDy()}},{key:"_validateData",value:function(t){if(Array.isArray(t)===!1)throw new Error("Data must be an array.");if(0===t.length)throw new Error("Data array must contain at least one element.");if(Array.isArray(t[0])===!1)throw new Error("Data array elements must be arrays.");if(t[0].length<2)throw new Error("Data array elements must contain a label and value.")}},{key:"_getSettings",value:function(e){var i=b["default"].extend({},t.defaults);return i.chart.width=parseInt(s["default"].select(this.selector).style("width"),10),i.chart.height=parseInt(s["default"].select(this.selector).style("height"),10),i=b["default"].extend(i,e),i.chart.width<=0&&(i.chart.width=t.defaults.chart.width),i.chart.height<=0&&(i.chart.height=t.defaults.chart.height),i}},{key:"_setBlocks",value:function(t,e){var i=this._getTotalCount(t,e);this.blocks=this._standardizeData(t,i)}},{key:"_getTotalCount",value:function(t,e){var i=this;if(e.chart&&e.chart.totalCount)return parseInt(e.chart.totalCount,10)||0;var a=0;return t.forEach(function(t){a+=i._getRawBlockCount(t)}),a}},{key:"_standardizeData",value:function(t,e){var i=this,a=[];return t.forEach(function(t,r){var n=i._getRawBlockCount(t),o=n/e||0,l=t[0];a.push({index:r,ratio:o,value:n,height:i.height*o,fill:i.colorizer.getBlockFill(t,r,i.fillType),label:{raw:l,formatted:i.labelFormatter.format(l,n),color:i.colorizer.getLabelFill(t)}})}),a}},{key:"_getRawBlockCount",value:function(t){return Array.isArray(t[1])?t[1][0]:t[1]}},{key:"_getDx",value:function(){return this.bottomPinch>0?this.bottomLeftX/(this.blocks.length-this.bottomPinch):this.bottomLeftX/this.blocks.length}},{key:"_getDy",value:function(){return this.isCurved?(this.height-this.curveHeight)/this.blocks.length:this.height/this.blocks.length}},{key:"_draw",value:function(){this.svg=s["default"].select(this.selector).append("svg").attr("width",this.width).attr("height",this.height);var t=this._makePaths();this.blockPaths=t[0],this.overlayPaths=t[1],"gradient"===this.fillType&&this._defineColorGradients(this.svg),this.isCurved&&this._drawTopOval(this.svg,this.blockPaths),this._drawBlock(0)}},{key:"_makePaths",value:function(){var t=this,e=[],i=[],a=this.dx,r=this.dy,n=0,o=this.width,l=0;this.isInverted&&(n=this.bottomLeftX,o=this.width-this.bottomLeftX);var s=0,h=0,u=0,c=this.width/2;this.isCurved&&(l=10);var f=this.height;0!==this.minHeight&&(f=this.height-this.minHeight*this.blocks.length);var d=this.height;this.blocks.forEach(function(e,i){t.bottomPinch>0&&(t.isInverted?i<t.bottomPinch&&(d-=e.height):i>=t.blocks.length-t.bottomPinch&&(d-=e.height))});var v=2*d/(this.width-this.bottomWidth);return this.blocks.forEach(function(d,y){t.dynamicHeight&&(r=f*d.ratio,0!==t.minHeight&&(r+=t.minHeight),t.isCurved&&(r-=t.curveHeight/t.blocks.length),s=(l+r)/v,t.isInverted&&(s=(l+r-t.height)/(-1*v)),0===t.bottomWidth&&y===t.blocks.length-1&&(s=t.width/2,t.isInverted&&(s=0)),t.bottomWidth===t.width&&(s=n),a=s-n,t.isInverted&&(a=n-s)),t.bottomPinch>0&&(t.isInverted?(t.dynamicHeight||(a=t.dx),a=y<t.bottomPinch?0:a):y>=t.blocks.length-t.bottomPinch&&(a=0)),s=n+a,h=o-a,u=l+r,t.isInverted&&(s=n-a,h=o+a);var b=o-n,g=h-s,p=b*(d.ratio||0)+n,k=g*(d.ratio||0)+s;p=Math.min(p,b),k=Math.min(k,g),t.isCurved?e.push([[n,l,"M"],[c,l+(t.curveHeight-10),"Q"],[o,l,""],[h,u,"L"],[h,u,"M"],[c,u+t.curveHeight,"Q"],[s,u,""],[n,l,"L"]]):(e.push([[n,l,"M"],[o,l,"L"],[h,u,"L"],[s,u,"L"],[n,l,"L"]]),t.addValueOverlay&&i.push([[n,l,"M"],[p,l,"L"],[k,u,"L"],[s,u,"L"],[n,l,"L"]])),n=s,o=h,l=u}),[e,i]}},{key:"_defineColorGradients",value:function(t){var e=this,i=t.append("defs");this.blocks.forEach(function(t,a){var r=t.fill.raw,n=e.colorizer.shade(r,-.2),o=i.append("linearGradient").attr({id:"gradient-"+a}),l=[[0,n],[40,r],[60,r],[100,n]];l.forEach(function(t){o.append("stop").attr({offset:t[0]+"%",style:"stop-color:"+t[1]})})})}},{key:"_drawTopOval",value:function(t,e){var i=0,a=this.width,r=this.width/2;this.isInverted&&(i=this.bottomLeftX,a=this.width-this.bottomLeftX);var n=e[0],o=n[1][1]+this.curveHeight-10,l=this.navigator.plot([["M",i,n[0][1]],["Q",r,o],[" ",a,n[2][1]],["M",a,10],["Q",r,0],[" ",i,10]]);t.append("path").attr("fill",this.colorizer.shade(this.blocks[0].fill.raw,-.4)).attr("d",l)}},{key:"_drawBlock",value:function(t){var e=this;if(t!==this.blocks.length){var i=this.svg.append("g"),a=this._getBlockPath(i,t);this._attachData(a,this.blocks[t]);var r=null,n=this.blocks[t].fill.actual;this.addValueOverlay&&!this.isCurved&&(r=this._getOverlayPath(i,t),this._attachData(r,this.blocks[t]),a.node().setAttribute("pathType","background"),r.node().setAttribute("pathType","foreground"),n=this.colorizer.shade(this.blocks[t].fill.raw,.3)),0!==this.animation?a.transition().duration(this.animation).ease("linear").attr("fill",n).attr("d",this._getPathDefinition(t)).each("end",function(){e._drawBlock(t+1)}):(a.attr("fill",n).attr("d",this._getPathDefinition(t)),this._drawBlock(t+1)),this.addValueOverlay&&!this.isCurved&&(a.attr("stroke",this.blocks[t].fill.raw),0!==this.animation?r.transition().duration(this.animation).ease("linear").attr("fill",this.blocks[t].fill.actual).attr("d",this._getOverlayPathDefinition(t)):r.attr("fill",this.blocks[t].fill.actual).attr("d",this._getOverlayPathDefinition(t))),this.hoverEffects&&[a,r].forEach(function(t){t&&t.on("mouseover",e._onMouseOver.bind(e)).on("mouseout",e._onMouseOut.bind(e))}),null!==this.onBlockClick&&[a,r].forEach(function(t){t&&t.on("click",e.onBlockClick)}),this._addBlockLabel(i,t)}}},{key:"_getBlockPath",value:function(t,e){var i=t.append("path");return 0!==this.animation&&this._addBeforeTransition(i,e),i}},{key:"_getOverlayPath",value:function(t,e){var i=t.append("path");return 0!==this.animation&&this._addBeforeTransition(i,e,!0),i}},{key:"_addBeforeTransition",value:function(t,e,i){var a=i?this.overlayPaths[e]:this.blockPaths[e],r="",n="";r=this.isCurved?this.navigator.plot([["M",a[0][0],a[0][1]],["Q",a[1][0],a[1][1]],[" ",a[2][0],a[2][1]],["L",a[2][0],a[2][1]],["M",a[2][0],a[2][1]],["Q",a[1][0],a[1][1]],[" ",a[0][0],a[0][1]]]):this.navigator.plot([["M",a[0][0],a[0][1]],["L",a[1][0],a[1][1]],["L",a[1][0],a[1][1]],["L",a[0][0],a[0][1]]]),n="solid"===this.fillType&&e>0?this.blocks[e-1].fill.actual:this.blocks[e].fill.actual,t.attr("d",r).attr("fill",n)}},{key:"_attachData",value:function(t,e){var i=n({},e,{node:t.node()});t.data([i])}},{key:"_getPathDefinition",value:function(t){var e=[];return this.blockPaths[t].forEach(function(t){e.push([t[2],t[0],t[1]])}),this.navigator.plot(e)}},{key:"_getOverlayPathDefinition",value:function(t){var e=[];return this.overlayPaths[t].forEach(function(t){e.push([t[2],t[0],t[1]])}),this.navigator.plot(e)}},{key:"_onMouseOver",value:function(t){for(var e=s["default"].event.target.parentElement.childNodes,i=0;i<e.length;i++){var a=e[i];if("path"===a.nodeName.toLowerCase()){var r=a.getAttribute("pathType")||"";"foreground"===r?s["default"].select(a).attr("fill",this.colorizer.shade(t.fill.raw,-.5)):s["default"].select(a).attr("fill",this.colorizer.shade(t.fill.raw,-.2))}}}},{key:"_onMouseOut",value:function(t){for(var e=s["default"].event.target.parentElement.childNodes,i=0;i<e.length;i++){var a=e[i];if("path"===a.nodeName.toLowerCase()){var r=a.getAttribute("pathType")||"";if("background"===r){var n=this.colorizer.shade(t.fill.raw,.3);s["default"].select(a).attr("fill",n)}else s["default"].select(a).attr("fill",t.fill.actual)}}}},{key:"_addBlockLabel",value:function(t,e){var i=this.blockPaths[e],a=this.blocks[e].label.formatted,r=this.blocks[e].label.color,n=this.width/2,o=this._getTextY(i);t.append("text").text(a).attr({x:n,y:o,fill:r,"text-anchor":"middle","dominant-baseline":"middle","pointer-events":"none"}).style("font-size",this.label.fontSize)}},{key:"_getTextY",value:function(t){return this.isCurved?(t[2][1]+t[3][1])/2+this.curveHeight/this.blocks.length:(t[1][1]+t[2][1])/2}}]),t}();g.defaults={chart:{width:350,height:400,bottomWidth:1/3,bottomPinch:0,inverted:!1,horizontal:!1,animate:0,addValueOverlay:!1,totalCount:null,curve:{enabled:!1,height:20}},block:{dynamicHeight:!1,fill:{scale:s["default"].scale.category10().domain(s["default"].range(0,10)),type:"solid"},minHeight:0,highlight:!1},label:{fontSize:"14px",fill:"#fff",format:"{l}: {f}"},events:{click:{block:null}}},e["default"]=g},function(e,i){e.exports=t},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),r=function(){function t(){i(this,t),this.hexExpression=/^#([0-9a-f]{3}|[0-9a-f]{6})$/i,this.labelFill=null,this.scale=null}return a(t,[{key:"setLabelFill",value:function(t){this.labelFill=t}},{key:"setScale",value:function(t){this.scale=t}},{key:"getBlockFill",value:function(t,e,i){var a=this.getBlockRawFill(t,e);return{raw:a,actual:this.getBlockActualFill(a,e,i)}}},{key:"getBlockRawFill",value:function(t,e){return t.length>2&&this.hexExpression.test(t[2])?t[2]:Array.isArray(this.scale)?this.scale[e]:this.scale(e)}},{key:"getBlockActualFill",value:function(t,e,i){return"solid"===i?t:"url(#gradient-"+e+")"}},{key:"getLabelFill",value:function(t){return t.length>3&&this.hexExpression.test(t[3])?t[3]:this.labelFill}},{key:"shade",value:function(t,e){var i=t.slice(1);3===i.length&&(i=this.expandHex(i));var a=parseInt(i,16),r=0>e?0:255,n=0>e?-1*e:e,o=a>>16,l=a>>8&255,s=255&a,h=16777216+65536*(Math.round((r-o)*n)+o)+256*(Math.round((r-l)*n)+l)+(Math.round((r-s)*n)+s);return"#"+h.toString(16).slice(1)}},{key:"expandHex",value:function(t){return t[0]+t[0]+t[1]+t[1]+t[2]+t[2]}}]),t}();e["default"]=r},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),r=function(){function t(){i(this,t),this.expression=null}return a(t,[{key:"setFormat",value:function(t){"function"==typeof t?this.formatter=t:(this.expression=t,this.formatter=this.stringFormatter)}},{key:"format",value:function(t,e){return Array.isArray(e)?this.formatter(t,e[0],e[1]):this.formatter(t,e,null)}},{key:"stringFormatter",value:function(t,e){var i=arguments.length<=2||void 0===arguments[2]?null:arguments[2],a=i;return null===i&&(a=this.getDefaultFormattedValue(e)),this.expression.split("{l}").join(t).split("{v}").join(e).split("{f}").join(a)}},{key:"getDefaultFormattedValue",value:function(t){return t.toLocaleString()}}]),t}();e["default"]=r},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),r=function(){function t(){i(this,t)}return a(t,[{key:"plot",value:function(t){var e="";return t.forEach(function(t){e+=t[0]+t[1]+","+t[2]+" "}),e.replace(/ +/g," ").trim()}}]),t}();e["default"]=r},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},r=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),n=function(){function t(){i(this,t)}return r(t,null,[{key:"extend",value:function(e,i){var r=void 0;for(r in i)i.hasOwnProperty(r)&&("object"!==a(i[r])||Array.isArray(i[r])||null===i[r]?e[r]=i[r]:"object"!==a(e[r])||Array.isArray(e[r])||null===i[r]?e[r]=t.extend({},i[r]):e[r]=t.extend(e[r],i[r]));return e}}]),t}();e["default"]=n}])});